<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu MCEE</title>
    <style>
        /* Styles gÃ©nÃ©raux */
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #5fc8f1, #97bfda);
            padding: 20px;
            color: #333;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .container {
            max-width: 500px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: auto;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        input[type="text"] {
            width: 80%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ff5722;
            border-radius: 8px;
            outline: none;
            text-align: center;
            margin-bottom: 10px;
        }

        button {
            width: 80%;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            background: #ff5722;
            color: white;
            border-radius: 10px;
            transition: 0.3s;
        }

        button:hover {
            background: #e64a19;
            transform: scale(1.05);
        }

        #jeu {
            display: none;
            margin-top: 20px;
        }

        .question-container {
            background: #ffcc80;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .reponses button {
            width: 100%;
            background: #ff9800;
            border: none;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;  /* Ajout de l'Ã©cart entre les boutons */
        }

        .reponses button:hover {
            background: #f57c00;
        }

        #resultat {
            margin-top: 15px;
            font-size: 20px;
            font-weight: bold;
            color: #d32f2f;
        }

        #nouveauJoueur {
            margin-top: 20px;
            font-size: 18px;
            cursor: pointer;
            background-color: #388e3c;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
        }

        #nouveauJoueur:hover {
            background-color: #2c6d29;
        }
    </style>
</head>
<body>

    <h1>ðŸŽ¯ Jeu MCEE</h1>

    <div class="container">
        <!-- Ã‰tape 1 : EntrÃ©e du numÃ©ro de membre -->
        <div id="accueil">
            <p>Entrez votre numÃ©ro de membre :</p>
            <input type="text" id="numeroMembre" placeholder="Ex: 123456">
            <button onclick="verifierMembre()">Valider</button>
            <p id="messageMembre"></p>
        </div>

        <!-- Ã‰tape 2 : Question alÃ©atoire -->
        <div id="jeu">
            <div class="question-container" id="question"></div>
            <div class="reponses" id="reponses"></div>
            <p id="resultat"></p>
        </div>


    </div>

    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbynbHELa1OlzwfA5kfQWP9waGRe4dZS42srm6SdVaGV54yA9ZQde1Nedk09vATrUPtA/exec';

        // VÃ©rification du membre
        function verifierMembre() {
            let numero = document.getElementById("numeroMembre").value;

            console.log('VÃ©rification du membre avec le numÃ©ro :', numero); // Ajout pour le dÃ©bogage

            document.getElementById("messageMembre").innerText = "VÃ©rification en cours..."; // Afficher un message de chargement

            fetch(`${scriptUrl}?action=verifierMembre&numeroMembre=${numero}`)
                .then(response => response.json())
                .then(data => {
                    console.log('RÃ©ponse de l\'API :', data); // Ajout pour le dÃ©bogage
                    document.getElementById("messageMembre").innerText = data.message;
                    if (data.message.includes("Bienvenue")) {
                        afficherQuestion();
                    } else {
                        console.log('Le message ne contient pas "Bienvenue"');
                    }
                })
                .catch(error => {
                    console.log('Erreur lors de la requÃªte :', error); // Ajout pour le dÃ©bogage
                });
        }

        // Afficher une question alÃ©atoire
        function afficherQuestion() {
            fetch(`${scriptUrl}?action=recupererQuestion`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("question").innerText = data.question;
                    const reponsesDiv = document.getElementById("reponses");
                    reponsesDiv.innerHTML = '';

                    // VÃ©rifier si l'API retourne des rÃ©ponses valides
                    const reponses = data.reponses.filter(reponse => reponse.trim() !== ''); // Retirer les rÃ©ponses vides

                    // Limiter Ã  un maximum de 4 rÃ©ponses (si plus de 4 rÃ©ponses sont retournÃ©es, on les ignore)
                    const reponsesLimite = reponses.slice(0, 4); 

                    // CrÃ©er les boutons de rÃ©ponse pour chaque rÃ©ponse disponible
                    reponsesLimite.forEach(reponse => {
                        let bouton = document.createElement("button");
                        bouton.innerText = reponse;
                        bouton.onclick = () => verifierReponse(bouton, reponse, data.bonneReponse);
                        reponsesDiv.appendChild(bouton);
                    });

                    document.getElementById("jeu").style.display = "block";
                    document.getElementById("accueil").style.display = "none";
                });
        }

        // VÃ©rifier la rÃ©ponse et bloquer les autres rÃ©ponses
        function verifierReponse(boutonClique, reponse, bonneReponse) {
            const estCorrect = reponse === bonneReponse;
            document.getElementById("resultat").innerText = estCorrect ? "ðŸŽ‰ Bravo, vous avez la bonne rÃ©ponse! ðŸŽ‰<br>Rendez-vous au stand de la CMEQ pour participer au tirage" : "âŒ RatÃ©!";
            document.getElementById("resultat").style.color = estCorrect ? "#388E3C" : "#d32f2f";

            // DÃ©sactiver tous les boutons de rÃ©ponse aprÃ¨s la premiÃ¨re sÃ©lection
            const boutonsReponse = document.querySelectorAll(".reponses button");
            boutonsReponse.forEach(button => {
                button.disabled = true;
            });

            // Enregistrer le rÃ©sultat
            const numeroMembre = document.getElementById("numeroMembre").value;
            fetch(`${scriptUrl}?action=enregistrerResultat&numeroMembre=${numeroMembre}&bonneReponse=${estCorrect}`)
                .then(response => response.json())
                .then(data => console.log(data.message));

            // Afficher le bouton pour recommencer
            document.getElementById("nouveauJoueur").style.display = "inline-block";
        }

        // Revenir au dÃ©but pour un nouveau joueur
        function nouveauJoueur() {
            document.getElementById("numeroMembre").value = '';
            document.getElementById("messageMembre").innerText = '';
            document.getElementById("resultat").innerText = '';  // RÃ©initialisation du texte du rÃ©sultat
            document.getElementById("jeu").style.display = "none";
            document.getElementById("accueil").style.display = "block";
            document.getElementById("nouveauJoueur").style.display = "none";
        }
    </script>

</body>
</html>
